"use strict";function _interopRequireDefault(r){return r&&r.__esModule?r:{default:r}}function _asyncToGenerator(r){return function(){var e=r.apply(this,arguments);return new Promise(function(r,t){function n(u,a){try{var i=e[u](a),o=i.value}catch(r){return void t(r)}if(!i.done)return Promise.resolve(o).then(function(r){n("next",r)},function(r){n("throw",r)});r(o)}return n("next")})}}function convert2Buffer(r){for(var e=r.reduce(function(r,e){return r+e.length},0),t=new ArrayBuffer(e),n=new Uint8Array(t),u=0,a=0;a<r.length;a++){for(var i=0;i<r[a].length;i++)n[u+i]=r[a][i];u+=r[a].length}return t}function getFieldHeader(r,e){return""+splitBoundary+br+'Content-Disposition: form-data; name="'+r+'"'+br2+e+br}function getFileHeader(r,e){var t=getType(e),n="",u=e.match(/(?:(?!\/).)*$/);return u&&(n=u[0]),""+splitBoundary+br+'Content-Disposition: form-data; name="'+r+'"; filename="'+n+'"'+br+"Content-Type: "+t+br2}function generateBoundary(){for(var r="----WebKitFormBoundary",e="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",t=e.length,n=0;n<16;n++)r+=e.charAt(~~(Math.random()*t));return r}function str2Uint8Arr(r){for(var e=[],t=0;t<r.length;t++){var n=r.charCodeAt(t);0<=n&&n<=127?e.push(n):128<=n&&n<=2047?(e.push(192|31&n>>6),e.push(128|63&n)):(2048<=n&&n<=55295||57344<=n&&n<=65535)&&(e.push(224|15&n>>12),e.push(128|63&n>>6),e.push(128|63&n))}for(var u=0;u<e.length;u++)e[u]&=255;return e}function file2Uint8Arr(r){return new Promise(function(e){wx.getFileSystemManager().readFile({filePath:r,success:function(r){e(new Uint8Array(r.data))},fail:function(r){console.error(r.errMsg)}})})}function getType(r){var e=r.lastIndexOf("."),t=r.substr(e+1);for(var n in _mimeDb2.default)if(void 0!==_mimeDb2.default[n].extensions&&-1!==_mimeDb2.default[n].extensions.indexOf(t))return n;return null}Object.defineProperty(exports,"__esModule",{value:!0}),exports.multipartUpload=void 0;var _extends=Object.assign||function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])}return r},multipartUpload=exports.multipartUpload=function(){var r=_asyncToGenerator(regeneratorRuntime.mark(function r(e){var t,n=e.url,u=e.header,a=e.fields,i=e.files,o=e.success,s=e.fail;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,toBuffer(a,i);case 2:return t=r.sent,r.abrupt("return",uni.request({url:n,data:t,method:"POST",header:_extends({},u,{"Content-Type":"multipart/form-data; boundary="+boundary}),success:function(r){o(r)},fail:function(r){s(r)}}));case 4:case"end":return r.stop()}},r,this)}));return function(e){return r.apply(this,arguments)}}(),toBuffer=function(){var r=_asyncToGenerator(regeneratorRuntime.mark(function r(e,t){var n,u,a,i,o,s,f;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:n=[],u="";for(a in e)u+=getFieldHeader(a,e[a]);n.push(str2Uint8Arr(u)),r.t0=regeneratorRuntime.keys(t);case 5:if((r.t1=r.t0()).done){r.next=17;break}return i=r.t1.value,o=t[i],s=getFileHeader(i,o),n.push(str2Uint8Arr(s)),r.next=12,file2Uint8Arr(o);case 12:f=r.sent,n.push(f),n.push(str2Uint8Arr(br)),r.next=5;break;case 17:return n.push(str2Uint8Arr(splitBoundary+"--")),r.abrupt("return",convert2Buffer(n));case 19:case"end":return r.stop()}},r,this)}));return function(e,t){return r.apply(this,arguments)}}(),_mimeDb=require("mime-db"),_mimeDb2=_interopRequireDefault(_mimeDb),br="\r\n",br2="\r\n\r\n",boundary=generateBoundary(),splitBoundary="--"+boundary;